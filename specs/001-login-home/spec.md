# 功能規格：登入記帳主頁功能

**功能分支**: `001-login-home`  
**建立日期**: 2025-11-16  
**狀態**: 草稿  
**輸入**: 使用者需求描述：「Flutter app - 登入記帳主頁功能」  
**Figma 設計**: https://www.figma.com/design/oWY8jjLOAJyY2z7FJ8gUrh/登入記帳主頁功能  
**設計資源**: `design-assets/` 資料夾包含所有匯出的圖示和頁面截圖

## 術語定義

為確保文件一致性，本規格使用以下術語定義：

- **Supabase Auth 會話**: Supabase 認證服務維護的伺服器端會話，包含 access_token 和 refresh_token，由 Supabase Auth API 管理
- **本地 token**: 儲存於裝置本地安全儲存（Flutter Secure Storage）的 access_token 和 refresh_token，用於自動登入
- **會話記錄**: Supabase Database 中 `sessions` 表格的記錄，用於追蹤多裝置登入狀態和裝置資訊
- **登入提供商**: 社群登入平台（Google 或 Facebook）
- **施工中元件**: 首頁顯示的佔位 UI 元件，告知使用者記帳功能開發中

## 設計規格 *(必要)*

### 色彩系統

#### 主要色彩

| 顏色代碼 | 色彩名稱 | 用途說明 | 驗收標準 |
|---------|---------|---------|---------|
| `#ffffff` | 背景白 | 主要背景色，用於登入頁面和首頁背景 | 所有頁面背景使用此色 |
| `#f9fafb` | 背景灰 | 次要背景色，用於卡片和容器背景 | 容器和卡片元件使用此色 |
| `#86efcc` | 主題綠 | 品牌主題色，用於強調元素（如首頁 Header） | Header 背景使用此色 |

#### 文字色彩

| 顏色代碼 | 色彩名稱 | 用途說明 | 驗收標準 |
|---------|---------|---------|---------|
| `#0a0a0a` | 文字黑 | 主要文字色，用於標題和重要內容 | 標題和主要文字使用此色 |
| `#495565` | 文字灰 | 次要文字色，用於說明文字和副標題 | 次要資訊和說明文字使用此色 |
| `#354152` | 按鈕文字 | 按鈕內文字色 | 社群登入按鈕文字使用此色 |

#### 社群平台品牌色

| 顏色代碼 | 色彩名稱 | 用途說明 | 驗收標準 |
|---------|---------|---------|---------|
| `#4285f4` | Google 藍 | Google Logo 藍色部分 | Google 按鈕 Logo 使用 |
| `#34a853` | Google 綠 | Google Logo 綠色部分 | Google 按鈕 Logo 使用 |
| `#fbbc05` | Google 黃 | Google Logo 黃色部分 | Google 按鈕 Logo 使用 |
| `#ea4335` | Google 紅 | Google Logo 紅色部分 | Google 按鈕 Logo 使用 |
| `#1877f2` | Facebook 藍 | Facebook 品牌色 | Facebook 按鈕背景和 Logo 使用 |

### 文字樣式

| 樣式名稱 | 字級 (px) | 字重 | 行高 (px) | 用途 | 驗收標準 |
|---------|----------|------|-----------|------|---------|
| `display-large` | 30 | 500 | 36 | 首頁主標題 | 首頁「施工中」標題使用 |
| `headline-medium` | 24 | 400 | 32 | 登入頁標題 | 登入頁歡迎文字使用 |
| `body-large` | 16 | 400 | 24 | 內文說明 | 說明文字和提示訊息使用 |
| `label-medium` | 14 | 500 | 20 | 按鈕文字 | 所有按鈕文字使用 |

### 間距系統

| 間距代碼 | 數值 (px) | 用途說明 | 驗收標準 |
|---------|----------|---------|---------|
| `spacing-xs` | 8 | 極小間距 | 元素內部小間距、Icon 與文字間距 |
| `spacing-sm` | 12 | 小間距 | 列表項目間距、小元件間距 |
| `spacing-md` | 16 | 中間距 | 按鈕內部 padding、卡片內部 padding | 
| `spacing-lg` | 24 | 大間距 | 按鈕之間間距、區塊間距 |
| `spacing-xl` | 32 | 極大間距 | 頁面上下 padding、大區塊間距 |

### 視覺元件規格

#### 登入按鈕

- **尺寸**: 寬度填滿容器（扣除左右 padding），高度 48px
- **圓角**: 8px
- **內部 padding**: 左右 `spacing-md` (16px)，上下 `spacing-sm` (12px)
- **文字**: `label-medium` 樣式，顏色 `#354152`
- **Google 按鈕**: 背景 `#ffffff`，邊框 1px `#e0e0e0`，左側 Google Logo
- **Facebook 按鈕**: 背景 `#1877f2`，文字顏色 `#ffffff`，左側 Facebook Logo
- **間距**: 兩個按鈕之間 `spacing-md` (16px)

#### 首頁佔位區

- **背景色**: `#f9fafb`
- **內部 padding**: `spacing-xl` (32px)
- **標題**: `display-large` 樣式，顏色 `#0a0a0a`
- **說明文字**: `body-large` 樣式，顏色 `#495565`
- **標題與說明間距**: `spacing-md` (16px)

#### Header (首頁頂部)

- **背景色**: `#86efcc`（主題綠）
- **高度**: 建議 56px - 64px
- **內部 padding**: 左右 `spacing-md` (16px)
- **登出按鈕**: 右上角，`label-medium` 樣式

## 使用者情境與測試 *(必要)*

### 使用者故事 1 - 社群帳號登入 (優先級: P1)

使用者首次開啟 APP 時，可以透過 Google 或 Facebook 帳號快速登入，無需註冊新帳號。登入成功後，系統會記住使用者的登入狀態，下次開啟 APP 時自動進入首頁。

**為何優先**: 這是 APP 的入口功能，沒有登入功能使用者無法使用任何記帳功能。社群帳號登入可以降低使用者進入門檻，提高轉換率。

**獨立測試**: 可以透過點擊 Google/Facebook 登入按鈕，驗證是否成功導向社群平台授權頁面，授權後是否正確返回 APP 並顯示首頁。不需要實作記帳功能即可驗證登入流程。

**驗收情境**:

1. **Given** 使用者首次開啟 APP，**When** 使用者看到登入頁面，**Then** 頁面顯示 Google 和 Facebook 登入按鈕
2. **Given** 使用者在登入頁面，**When** 使用者點擊 Google 登入按鈕，**Then** 系統開啟 Google 授權頁面
3. **Given** 使用者在 Google 授權頁面，**When** 使用者完成授權，**Then** 系統返回 APP 並顯示首頁
4. **Given** 使用者在登入頁面，**When** 使用者點擊 Facebook 登入按鈕，**Then** 系統開啟 Facebook 授權頁面
5. **Given** 使用者在 Facebook 授權頁面，**When** 使用者完成授權，**Then** 系統返回 APP 並顯示首頁
6. **Given** 使用者已成功登入，**When** 使用者關閉 APP 後重新開啟，**Then** 系統自動進入首頁（不需要重新登入）

---

### 使用者故事 2 - 登出功能 (優先級: P2)

已登入的使用者可以從首頁登出，清除登入狀態並返回登入頁面。這讓使用者可以切換帳號或保護隱私。

**為何優先**: 登出是重要的安全功能，讓使用者可以控制自己的帳號狀態。雖然不如登入重要，但仍是完整使用者體驗的必要部分。

**獨立測試**: 可以在首頁點擊登出按鈕，驗證是否清除登入狀態並返回登入頁面，再次開啟 APP 時是否顯示登入頁面而非自動登入。

**驗收情境**:

1. **Given** 使用者已登入並在首頁，**When** 使用者點擊登出按鈕，**Then** 系統清除登入狀態並導向登入頁面
2. **Given** 使用者已登出，**When** 使用者關閉 APP 後重新開啟，**Then** 系統顯示登入頁面（不自動登入）
3. **Given** 使用者已登出，**When** 使用者再次使用社群帳號登入，**Then** 系統正常完成登入流程

---

### 使用者故事 3 - 首頁佔位顯示 (優先級: P3)

使用者成功登入後進入首頁，首頁顯示「施工中」圖示，表示記帳功能正在開發中。這提供基本的使用者回饋，確認登入成功。

**為何優先**: 這是 MVP 階段的暫時方案，讓使用者知道登入成功，並告知記帳功能即將推出。雖然不是核心功能，但對測試登入流程很重要。

**獨立測試**: 登入成功後檢查首頁是否顯示施工中圖示和說明文字，不需要實作任何記帳功能。

**驗收情境**:

1. **Given** 使用者完成登入，**When** 系統導向首頁，**Then** 首頁顯示施工中圖示
2. **Given** 使用者在施工中首頁，**When** 使用者查看頁面，**Then** 顯示友善的說明文字（如「記帳功能開發中，敬請期待」）
3. **Given** 使用者在施工中首頁，**When** 使用者可以看到登出按鈕，**Then** 登出功能正常運作

---

### 邊緣案例

- **網路中斷**: 使用者在登入過程中網路中斷時，系統顯示錯誤訊息並允許重試
- **授權取消**: 使用者在社群平台授權頁面取消授權時，系統返回登入頁面並顯示提示訊息
- **授權失敗**: 社群平台授權失敗時（如帳號被停用），系統顯示具體錯誤訊息
- **會話過期**: 使用者長時間未使用 APP 導致會話過期時,系統自動導向登入頁面,並視覺上突出顯示使用者上次使用的登入提供商(Google 或 Facebook),便於快速重新登入
- **多裝置登入**: 使用者可以在多個裝置上同時登入,每個裝置維護獨立的會話狀態。在裝置 A 登入不會影響裝置 B 的登入狀態
- **首次安裝**: 使用者首次安裝 APP 時，確保顯示登入頁面而非首頁

## 需求 *(必要)*

### 功能需求

#### 登入功能

- **FR-001**: 系統必須提供 Google 社群帳號登入選項
- **FR-002**: 系統必須提供 Facebook 社群帳號登入選項
- **FR-003**: 使用者必須能夠透過點擊登入按鈕啟動社群平台授權流程
- **FR-004**: 系統必須在社群平台授權成功後接收使用者基本資訊（如姓名、電子郵件、頭像）
- **FR-004a**: 系統必須將使用者基本資訊儲存於裝置本地和伺服器端，用於身份識別和未來功能支援
- **FR-005**: 系統必須在登入成功後儲存使用者會話狀態
- **FR-006**: 系統必須在使用者重新開啟 APP 時自動檢查會話狀態
- **FR-007**: 系統必須在會話有效時自動導向首頁，跳過登入頁面
- **FR-008**: 系統必須在會話失效時顯示登入頁面
- **FR-008a**: 系統必須記住使用者上次使用的登入提供商,在會話過期後的登入頁面上視覺突出顯示該選項

#### 登出功能

- **FR-009**: 系統必須在首頁提供登出按鈕或選項
- **FR-010**: 系統必須在使用者點擊登出時清除 Supabase Auth 會話和本地 token，但保留使用者偏好的登入提供商記錄
- **FR-011**: 系統必須在登出後導向登入頁面，並視覺突出顯示上次使用的登入提供商
- **FR-012**: 系統必須在登出後確保下次開啟 APP 時不自動登入

#### 首頁顯示

- **FR-013**: 系統必須在登入成功後顯示首頁
- **FR-014**: 首頁必須顯示施工中圖示或佔位圖
- **FR-015**: 首頁必須顯示說明文字，告知使用者記帳功能開發中
- **FR-016**: 首頁必須提供登出功能入口

#### 錯誤處理

- **FR-017**: 系統必須在網路錯誤時顯示友善的錯誤訊息
- **FR-018**: 系統必須在授權失敗時顯示具體的錯誤原因
- **FR-019**: 系統必須在授權被取消時返回登入頁面並提供重試選項
- **FR-020**: 系統必須在會話過期時自動清除狀態並導向登入頁面

### 關鍵實體

- **使用者 (User)**: 代表一個已登入的使用者帳號，包含從社群平台取得的基本資訊（使用者 ID、姓名、電子郵件、頭像 URL、當前登入提供商類型、上次使用的登入提供商）。此資料儲存於裝置本地和伺服器端，用於身份識別、顯示使用者資訊、支援會話過期後記住使用者偏好的登入方式，並支援未來的跨裝置資料同步功能
- **會話 (Session)**: 代表使用者的登入狀態，包含 Supabase Auth 會話 token（access_token 和 refresh_token）、建立時間、過期時間、最後活動時間、裝置識別碼。每個裝置維護獨立的 Supabase Auth 會話和會話記錄，允許同一使用者在多個裝置上同時保持登入狀態
- **登入提供商 (AuthProvider)**: 代表社群登入平台類型（Google 或 Facebook），關聯到對應的授權設定

## 成功標準 *(必要)*

### 可衡量成果

- **SC-001**: 使用者可以在 30 秒內完成社群帳號登入流程（從點擊登入按鈕到進入首頁）
- **SC-002**: 95% 的登入嘗試在正常網路條件下成功完成
- **SC-003**: 已登入使用者在重新開啟 APP 時，可在 3 秒內自動進入首頁（不需要重新登入）
- **SC-004**: 使用者可以在 5 秒內找到並完成登出操作
- **SC-005**: 系統在網路錯誤或授權失敗時，100% 的情況下顯示清楚的錯誤訊息
- **SC-006**: 登入頁面和首頁在各種螢幕尺寸（手機、平板）上都能正確顯示
- **SC-007**: 90% 的使用者在首次使用時能成功完成登入，無需額外協助

### 假設

- 使用者已在裝置上安裝並登入 Google 或 Facebook 帳號
- 使用者的裝置有穩定的網路連線
- 社群平台（Google、Facebook）的授權服務正常運作
- 使用者同意授予 APP 存取其基本個人資訊的權限
- 會話預設有效期為 30 天（可在實作階段根據安全需求調整）

## 澄清事項

### 會談 2025-11-16

- Q: 多裝置登入策略 - 使用者在其他裝置登入時的行為? → A: 允許多裝置同時登入,每個裝置維護獨立會話
- Q: 使用者資料隱私範圍 - 從社群平台取得的使用者資料如何儲存和使用? → A: 儲存基本資訊於本地和伺服器,用於身份識別和未來功能
- Q: 會話過期後的使用者體驗 - 會話過期時是否記住使用者偏好的登入方式? → A: 記住上次使用的登入提供商,視覺上突出顯示該選項
